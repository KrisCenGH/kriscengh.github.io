import{_ as C,r as o,j as x,i as v,c as l,a as n,F as b,s as w,h as L,o as r,p as B,f as I,m as f,t as c,x as M,y as R,b as g}from"./index-gVKdl7Fj.js";import{f as S}from"./formatChatTime-DR8uvMaV.js";const E={class:"chat"},T=["src"],F={key:0,class:"unread-bubble"},N={class:"name"},V={class:"time"},X={class:"last-message"},Y=["onClick"],j="http://142.171.30.197:10086",z={__name:"Chat",setup(A){const s=o([]);x(async()=>{const{sessions:e}=await v.post("/session/list");s.value=e});const i=o(null),d=o(0),_=o(0);function h(e,a){d.value=e.clientX,_.value=e.clientY,i.value=a,document.addEventListener("click",m)}function m(){i.value=null,document.removeEventListener("click",m)}async function y(e){if(window.confirm("你确定要删除这个聊天吗？"))try{const{message:a}=await v.post("/session/delete",{sessionType:e.session_type,targetId:e.target_id});s.value=s.value.filter(u=>u.target_id!==e.target_id)}catch{window.alert("删除聊天失败！")}}function k(e){if(e.session_type===0)return j+e.avatar_url;if(e.session_type===1)return"../../../public/group.png"}return(e,a)=>{const u=L("RouterLink");return r(),l("div",E,[a[0]||(a[0]=n("div",{class:"placeholder-div"},null,-1)),(r(!0),l(b,null,w(s.value,t=>(r(),B(u,{class:"session",key:t.target_id,onContextmenu:g(p=>h(p,t.target_id),["right","prevent"]),to:{name:t.session_type?"groupChat":"friendChat",params:{targetId:t.target_id}}},{default:I(()=>[n("img",{src:k(t),class:"avatar"},null,8,T),t.unread_count?(r(),l("div",F,c(t.unread_count>99?"99+":t.unread_count),1)):f("",!0),n("div",N,c(t.display_name),1),n("div",V,c(M(S)(t.last_message_time)),1),n("div",X,c(t.last_sender_name?t.last_sender_name+"："+t.last_message:t.last_message),1),i.value===t.target_id?(r(),l("div",{key:1,class:"right-menu",style:R({left:d.value+"px",top:_.value+"px"})},[n("div",{class:"right-menu-item",onClick:g(p=>y(t),["prevent"])},"删除该聊天",8,Y)],4)):f("",!0)]),_:2},1032,["onContextmenu","to"]))),128)),a[1]||(a[1]=n("div",{class:"bottem-placeholder-div"},null,-1))])}}},$=C(z,[["__scopeId","data-v-fbd1bc0f"]]);export{$ as default};
