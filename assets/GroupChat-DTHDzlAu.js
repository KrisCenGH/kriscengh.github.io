import{_ as N,r as c,u as V,z as L,q as K,n as q,j as P,i as l,B as y,c as r,a as s,m as f,p as U,t as _,f as k,x as m,F as Y,s as j,w as z,v as A,C as E,b as C,d as H,h as J,o,e as B}from"./index-gVKdl7Fj.js";import{_ as O}from"./bu_-IAMiqBfy.js";import{_ as Q,a as W}from"./emoji-K3bF6cTu.js";import{_ as X}from"./icons_outlined_addoutline-BzaaHx0t.js";import{u as Z}from"./groupmessages-COs2YUEp.js";import{a as R,f as $}from"./formatChatTime-DR8uvMaV.js";const ee={class:"group-chat"},te={class:"top-bar"},se={class:"title"},ae={key:0,class:"time"},oe={key:1,class:"message-me"},re={class:"text-me"},ne=["src"],ie={key:2,class:"message-target"},ue=["src"],le={class:"name-target-container"},de={class:"name"},ce={class:"text-target"},me={key:0,class:"message-input"},pe=["onKeydown"],_e={key:0,src:X,class:"input-icon"},ve={key:1,class:"bottem-placeholder-div"},T="http://142.171.30.197:10086",ge={__name:"GroupChat",setup(fe){const n=K(),S=H(),p=c([]),b=c(""),M=c(),v=c(!0),u=c(""),h=V(),w=Z(),D=c(),d=L(()=>w.getMessagesByGroup(n.params.targetId));q(d,async()=>{if(!d.value[0])return;const{users:a}=await l.post("/user/search",{query:d.value[0].senderId});p.value.push({send_time:new Date,sender_id:d.value[0].senderId,username:a[0].username,avatar_url:a[0].avatar_url,content:d.value[0].content});const{message:e}=await l.post("/session/clear-unread",{sessionType:1,targetId:n.params.targetId});w.deleteMessage(d.value[0].groupId),await y(),g()},{immediate:!0}),P(async()=>{const{messages:a}=await l.post("/groups/messages",{groupId:n.params.targetId});p.value=a;const{name:e,memberCount:i}=await l.post("/groups/members-count",{groupId:n.params.targetId});b.value=e,M.value=i;const{isGroupMember:t}=await l.post("/groups/ismember",{groupId:n.params.targetId});v.value=t;const{message:I}=await l.post("/session/clear-unread",{sessionType:1,targetId:n.params.targetId});w.deleteMessage(n.params.targetId),await y(),g(!1)});async function x(){if(u.value!=="")try{const{message:a}=await l.post("/groups/send-message",{groupId:n.params.targetId,messageType:0,content:u.value});p.value.push({send_time:new Date,sender_id:h.userInfo.user.id,content:u.value}),await y(),g({behavior:"smooth",block:"end",inline:"nearest"}),u.value=""}catch{window.alert("发送失败！")}}function F(a){const e=new Date(a),i=new Date;return e.getFullYear()===i.getFullYear()&&e.getMonth()===i.getMonth()&&e.getDate()===i.getDate()}function g(a){var e;(e=D.value)==null||e.scrollIntoView(a)}function G(){S.back()}return(a,e)=>{const i=J("RouterLink");return o(),r("div",ee,[s("div",te,[s("div",{class:"back-triangle",onClick:G}),s("div",se,_(b.value+"("+M.value+")"),1),v.value?(o(),U(i,{key:0,to:{name:"groupInfo",params:{targetId:m(n).params.targetId}}},{default:k(()=>e[1]||(e[1]=[s("img",{src:O,class:"info-icon"},null,-1)])),_:1},8,["to"])):f("",!0)]),e[4]||(e[4]=s("div",{class:"top-placeholder-div"},null,-1)),(o(!0),r(Y,null,j(p.value,(t,I)=>(o(),r("div",null,[I>0&&new Date(t.send_time)-new Date(p.value[I-1].send_time)>3*60*1e3?(o(),r("div",ae,_(F(t.send_time)?m(R)(t.send_time):m($)(t.send_time)+" "+m(R)(t.send_time)),1)):f("",!0),t.sender_id===m(h).userInfo.user.id?(o(),r("div",oe,[s("div",re,_(t.content),1),B(i,{to:{name:"friendProfile",params:{targetId:t.sender_id}}},{default:k(()=>[s("img",{src:T+m(h).userInfo.user.avatar_url,class:"avatar"},null,8,ne)]),_:2},1032,["to"])])):(o(),r("div",ie,[B(i,{to:{name:"friendProfile",params:{targetId:t.sender_id}}},{default:k(()=>[s("img",{src:T+t.avatar_url,class:"avatar"},null,8,ue)]),_:2},1032,["to"]),s("div",le,[s("div",de,_(t.username),1),s("div",ce,_(t.content),1)])]))]))),256)),v.value?(o(),r("div",me,[e[2]||(e[2]=s("img",{src:Q,class:"input-icon",style:{height:"3.4em",width:"3.4em"}},null,-1)),z(s("textarea",{class:"text-input","onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),onFocus:g,onKeydown:E(C(x,["prevent"]),["enter"])},null,40,pe),[[A,u.value]]),e[3]||(e[3]=s("img",{src:W,class:"input-icon",style:{height:"3.4em",width:"3.4em"}},null,-1)),u.value===""?(o(),r("img",_e)):(o(),r("button",{key:1,class:"send",onClick:C(x,["prevent"])},"发送"))])):f("",!0),v.value?(o(),r("div",ve)):f("",!0),s("div",{ref_key:"bottomRef",ref:D},null,512)])}}},Me=N(ge,[["__scopeId","data-v-43f5cb28"]]);export{Me as default};
